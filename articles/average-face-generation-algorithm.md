---
title: "顔を混ぜる技術 ― 平均顔生成のアルゴリズム解説"
emoji: "😸"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Python, OpenCV, 画像処理, アルゴリズム]
published: false
---
# はじめに
「平均顔」って聞いたことありますか？
これは、たくさんの顔を重ね合わせて作る、一つの“**平均的な顔**”のことです。

この記事では、PythonとOpenCVを使って、そんな平均顔をどうやって作るかを解説します。
顔処理に興味がある人はぜひチェックしてみてくださいね！

# 平均顔とは

![](/images/articles/average-face-generation-algorithm/WhatIsaverageFaceGeneration.png)

平均顔とは、複数の個別の顔画像から共通する特徴を抽出し、それらを統合して作られた「合成された顔画像」のことを指します。具体的には、たくさんの顔のパーツ（目・鼻・口など）の位置や形を揃え、それぞれの対応する部分の情報を平均化することで、全体として一つの顔として表現します。

この「平均」というのは、単に画像を重ねるだけでなく、顔の特徴点を正確に合わせて形状や表情のズレを補正した上で平均化するため、自然でリアルな顔が生成されます。つまり、複数の顔の特徴が調和して一つの理想的な顔ができあがるイメージです。

心理学の研究によると、この平均顔は多くの人が「魅力的」と感じる傾向があります。これは平均顔が、顔の非対称や不規則な特徴を打ち消し、バランスの取れた顔の形を示すためと考えられています。

# 平均顔生成の全体フロー
- 顔画像の収集
- 顔ランドマーク検出（特徴点の取得）
- 画像のリサイズとスケーリング
- Delaunay三角形分割を用いた位置合わせ（局所変形）
- ピクセルごとの平均化
- 出力と仕上げ

# 顔画像の前処理
- 顔検出：dlibのHOGベース検出器を利用
- ランドマーク検出：dlibの68点モデル
- 画像のリサイズとランドマーク座標のスケーリング
- 顔検出失敗時の処理

# 位置合わせ（Alignment）の仕組み
- 顔の特徴点を基準に平均形状を算出
- Delaunay三角形分割とは何か
- 各画像の三角形ごとにアフィン変換をかける局所ワーピング
- `warp_triangle`関数の説明と役割
- 防御的な境界チェックの重要性

# ピクセルごとの平均化
- 全画像のワープ後画像を合成
- 各画素値の単純平均を計算
- 出力画像の型変換とクリッピング処理

# 実装例：Pythonで平均顔を作る
- 使用ライブラリ（OpenCV, dlib, numpy, scipy）
- コードの主要関数紹介
  - `get_landmarks`
  - `apply_affine_transform`
  - `warp_triangle`
  - `calculate_average_face`
- メイン処理の流れ解説

# 実践時のポイント・注意点
- 入力画像のサイズや顔向きの均一化
- ランドマーク検出の精度と失敗対策
- 三角形分割の安定性
- 出力画像の色味調整（必要に応じて）

# 応用例
- 性別・年齢・地域別平均顔の比較
- GANなど他手法との組み合わせ
- 美しさ評価への応用

# まとめ

# 付録：なぜ平均顔は美しく見えるのか？科学とAIで読み解く
## 1. 心理学的背景
**アヴェレージング効果**（Averageness Effect）とは、多数の顔を平均化すると美しく見える現象です。これは、極端な特徴や非対称性が打ち消され、バランスの取れた顔になるためです。

進化心理学では、平均顔は**遺伝的多様性**や**良好な健康状態**を示すシグナルとされています。非対称性や特異な特徴は病気や遺伝的変異の可能性を示唆するため、私たちは本能的に、これらの兆候が少ない平均的な顔を魅力的に感じると考えられています。

## 2. 認知科学の視点
脳は顔を認識する際に、過去に見た顔の「プロトタイプ（典型）」を形成します。平均顔はこのプロトタイプに近く、脳にとって認識しやすい顔です。この**プロトタイプ効果**によって、脳は顔を処理する際の負担が少なく、その**処理のしやすさ**が親しみやすさや好感に繋がります。

## 3. AIと美の評価
顔認識AIや美的評価モデルは、顔の**対称性**や**各パーツの配置**といった多くの要素を数値化して評価します。これらの要素が平均顔の持つ特徴と高い相関関係にあるため、AIも平均顔を「美しい」と判断しやすい傾向があります。これは、AIが人間の美の基準に潜む**数学的な規則性**を学習しているためと考えられます。

## 4. 文化差と主観性
美の基準は文化や地域、個人によって異なります。平均顔の「美しさ」はあくまで「健康的で欠点がない」という普遍的な傾向であり、完全に普遍的ではありません。

**人種**や**文化圏**が異なれば、それぞれの「平均的な顔」も異なります。また、**性的二型性**、つまり男性らしさや女性らしさといった特徴も美の評価に影響します。これらの要素は、文化や個人の好みによってその重要性が変動します。したがって、私たちが感じる「美」は、平均顔の普遍的な傾向と文化的・個人的な好みが組み合わさって形成されるものです。